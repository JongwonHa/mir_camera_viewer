<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>MiR250 ì¹´ë©”ë¼ ë·°ì–´</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }
        
        h1 { text-align: center; margin-bottom: 10px; }
        
        .status-bar {
            text-align: center;
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
        }
        
        .status-dot {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-dot.connected { background: #00ff88; }
        .status-dot.disconnected { background: #ff4444; }
        
        .camera-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 15px;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .camera-box {
            background: #0f0f23;
            border-radius: 12px;
            padding: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.4);
        }
        
        .camera-box h3 {
            color: #4CAF50;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }
        
        .camera-box img {
            width: 100%;
            border-radius: 8px;
            background: #000;
            min-height: 180px;
            display: block;
        }
        
        .camera-box .no-image {
            width: 100%;
            min-height: 180px;
            background: #000;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }
        
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        
        button {
            padding: 10px 25px;
            margin: 5px;
            font-size: 14px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            background: #4CAF50;
            color: white;
        }
        button:hover { background: #45a049; }
        button.secondary { background: #2196F3; }
        
        .info { 
            text-align: center;
            margin-top: 15px;
            font-size: 0.85rem;
            color: #888;
        }
        
        .debug-link {
            display: block;
            text-align: center;
            margin-top: 10px;
            color: #4CAF50;
        }
    </style>
</head>
<body>
    <h1>ğŸ¤– MiR250 ì¹´ë©”ë¼ ë·°ì–´</h1>
    
    <div class="status-bar">
        <span class="status-dot" id="statusDot"></span>
        <span id="statusText">í™•ì¸ ì¤‘...</span>
        <span id="msgCount" style="margin-left: 20px; color: #888;"></span>
    </div>
    
    <div class="controls">
        <button onclick="refreshImages()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        <button class="secondary" onclick="window.open('/debug', '_blank')">ğŸ”§ ë””ë²„ê·¸</button>
    </div>
    
    <div class="camera-grid">
        <div class="camera-box">
            <h3>ğŸ“· ì™¼ìª½ ì ì™¸ì„  (Infra1)</h3>
            <img id="img_left_infra" src="/snapshot/left_infra" 
                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                 onload="this.style.display='block'; this.nextElementSibling.style.display='none';">
            <div class="no-image">ì´ë¯¸ì§€ ì—†ìŒ</div>
        </div>
        
        <div class="camera-box">
            <h3>ğŸ“· ì˜¤ë¥¸ìª½ ì ì™¸ì„  (Infra1)</h3>
            <img id="img_right_infra" src="/snapshot/right_infra"
                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                 onload="this.style.display='block'; this.nextElementSibling.style.display='none';">
            <div class="no-image">ì´ë¯¸ì§€ ì—†ìŒ</div>
        </div>
        
        
    <div class="info">
        ë¡œë´‡ IP: {{ robot_ip }} | ROS Bridge: ws://{{ robot_ip }}:9090
    </div>
    
    <a href="/debug" class="debug-link">ë””ë²„ê·¸ í˜ì´ì§€ ì—´ê¸°</a>

    <script>
        function refreshImages() {
            const timestamp = new Date().getTime();
            const cameras = ['left_infra', 'right_infra', 'left_depth', 'right_depth'];
            cameras.forEach(cam => {
                const img = document.getElementById('img_' + cam);
                img.src = '/snapshot/' + cam + '?' + timestamp;
            });
        }
        
        function checkStatus() {
            fetch('/status')
                .then(r => r.json())
                .then(data => {
                    const dot = document.getElementById('statusDot');
                    const text = document.getElementById('statusText');
                    const count = document.getElementById('msgCount');
                    
                    dot.className = 'status-dot ' + (data.connected ? 'connected' : 'disconnected');
                    text.textContent = data.connected ? 'ì—°ê²°ë¨ âœ…' : 'ì—°ê²° ì•ˆë¨ âŒ';
                    count.textContent = 'ë©”ì‹œì§€: ' + data.message_count;
                    
                    // ì´ë¯¸ì§€ ìˆìœ¼ë©´ ìë™ ìƒˆë¡œê³ ì¹¨
                    if (Object.values(data.images_available).some(v => v)) {
                        refreshImages();
                    }
                });
        }
        
        checkStatus();
        setInterval(checkStatus, 2000);
        setInterval(refreshImages, 3000);
    </script>
</body>
</html>
